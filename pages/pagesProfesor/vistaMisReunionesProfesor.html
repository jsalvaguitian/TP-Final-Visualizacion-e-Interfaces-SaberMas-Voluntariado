<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mis reuniones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <link href="../../css/mensajesProfesor.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/header-footer.css">
    <style>
        .estado {
            padding: 0.3rem 0.7rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
        }

        .estado-activa {
            background-color: #d1e7dd;
            color: #0f5132;
        }

        .estado-finalizada {
            background-color: #f8d7da;
            color: #842029;
        }

        .estado-pendiente {
            background-color: #fff3cd;
            color: #664d03;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background: rgba(0, 0, 0, 0.6);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .chat-message {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }

        .time {
            font-weight: bold;
            color: #666;
        }

        .name {
            font-weight: bold;
            color: #1d3f72;
        }

        .text {
            margin-left: 0.5rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        .download-btn {
            margin-top: 1rem;
            background-color: #2ecc71;
        }


        .estado {
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            color: white;
            font-weight: bold;
        }

        .estado-pendiente {
            background-color: #f39c12;
        }

        .estado-finalizada {
            background-color: #7f8c8d;
        }

        .estado-activa {
            background-color: #2ecc71;
        }

        /* Modal custom z-index */
        .modal-backdrop.show {
            z-index: 1040;
        }

        .modal.show {
            z-index: 1050;
        }

        /***/
        .estado-cancelada {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <header class="container-header">
        <div class="logo">
            <a href="../../index.html"><img src="../../assets/SaberMasVector3.svg" alt="" srcset=""></a>
        </div>

        <div class="container-btn js-botones d-none">
            <a class="btn btn-outline-primary btn-login-n" href="./pages/login.html">Iniciar sesion</a>
            <a class="btn btn-primary btn-header" href="./pages/registrarseEstudiante.html">Quiero aprender</a>
            <a class="btn btn-primary btn-header" href="./pages/registroProfesor.html">Quiero enseñar</a>
        </div>

        <div class="dropdown text-end menu-responsive d-none">
            <button class="btn btn-primary avatar-button text-center" type="button" id="menuUsuario"
                data-bs-toggle="dropdown" aria-expanded="false">
                <span class="material-symbols-outlined">
                    menu
                </span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="menuUsuario">
                <li><a class="dropdown-item" href="./pages/login.html"><i class="bi bi-box-arrow-in-right"></i> Iniciar
                        sesion</a>
                </li>
                <li><a class="dropdown-item" href="./pages/registrarseEstudiante.html"><i class="bi bi-person-plus"></i>
                        Quiero aprender</a></li>
                <li><a class="dropdown-item" href="./pages/registroProfesor.html"><i
                            class="bi bi-person-workspace"></i></i> Quiero enseñar</a></li>
            </ul>
        </div>
        <!--#######################################################################-->
        <div class="container-btn js-alumno-menu d-none">

            <div class="dropdown text-end">
                <button class="btn btn-primary avatar-button" type="button" id="menuUsuario" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    <span>¡Hola Juan!</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="menuUsuario">
                    <li>
                        <h6 class="dropdown-header"><span class="user-mail">juan@email.com </span></h6>
                    </li>
                    <li><a class="dropdown-item" href="./pages/vistaMensajesAlumnos.html"><i
                                class="bi bi-chat-dots"></i> Mis mensajes</a>
                    </li>
                    <li><a class="dropdown-item" href="./pages/vistaMisReuniones.html"><i
                                class="bi bi-calendar-event"></i> Mis reuniones</a></li>
                    <li><a class="dropdown-item" href="./pages/vistaMisDonaciones.html"><i class="bi bi-cash-coin"></i>
                            Mis donaciones</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="./pages/vistaMiPerfil.html"><i class="bi bi-person-circle"></i>
                            Mi perfil</a></li>
                    <li><a class="dropdown-item text-logout js-btn-login-al" href="#"><i
                                class="bi bi-box-arrow-right"></i> Cerrar
                            sesión</a></li>
                </ul>
            </div>
        </div>

        <!--#########################################-->
        <div class="container-btn js-profe-menu d-none">

            <div class="dropdown text-end">
                <button class="btn btn-primary avatar-button" type="button" id="menuUsuario" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    <span>¡Hola Martin!</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="menuUsuario">
                    <li>
                        <h6 class="dropdown-header"><span class="user-mail">martin@email.com </span></h6>
                    </li>
                    <li><a class="dropdown-item" href="./vistaMensajesProfesor.html"><i class="bi bi-chat-dots"></i> Mis
                            mensajes</a>
                    </li>
                    <li><a class="dropdown-item" href="./vistaMisReunionesProfesor.html"><i
                                class="bi bi-calendar-event"></i> Mis reuniones</a></li>
                    <li><a class="dropdown-item" href="./vistaDonacionesProfesor.html"><i class="bi bi-cash-coin"></i>
                            Mis donaciones</a></li>
                    <li>
                        <a class="dropdown-item d-flex justify-content-between align-items-center"
                            href="./vistaMisSolicitudesProfesor.html">
                            <span><i class="bi bi-person-check"></i> Mis solicitudes</span>
                            <span class="badge bg-danger rounded-pill">2</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="./vistaMiPerfilProfesor.html"><i class="bi bi-person-circle"></i>
                            Mi perfil</a></li>
                    <li><a class="dropdown-item text-logout js-btn-login-prof" href="#"><i
                                class="bi bi-box-arrow-right"></i> Cerrar
                            sesión</a></li>
                </ul>
            </div>
            <!---#########################################-->
        </div>
    </header>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-sm bg-body-tertiary bg-violeta nav-underline" data-bs-theme="dark">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="vistaMiPerfilProfesor.html">Mi perfil</a></li>
                    <li class="nav-item"><a class="nav-link" href="vistaMensajesProfesor.html">Mis mensajes</a></li>
                    <li class="nav-item"><a class="nav-link active" href="vistaMisReunionesProfesor.html">Mis
                            reuniones</a></li>
                    <li class="nav-item"><a class="nav-link" href="vistaDonacionesProfesor.html">Mis donaciones</a></li>
                    <li class="nav-item">
                        <a class="nav-link" href="vistaMisSolicitudesProfesor.html">Mis solicitudes</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div id="alert-container" class="mt-3"></div>
        <h3 class="mb-4 text-center">Mis reuniones</h3>
        <div class="table-responsive">
            <table class="table table-hover align-middle" id="tablaReuniones">
                <thead class="table-light">
                    <tr>
                        <th>Alumno</th>
                        <th>Materia</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Duración</th>
                        <th>Estado</th>
                        <th>Acción</th>
                        <th>Editar</th>
                        <th>Cancelar</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Juan Pérez</td>
                        <td>Matemática</td>
                        <td>08/07/2025</td>
                        <td> 18:00</td>
                        <td>45 min</td>
                        <td><span class="estado estado-pendiente">Pendiente</span></td>
                        <td><button class="btn btn-secondary btn-sm"
                                onclick="window.location.href='vistaSalaReunion.html'">Iniciar reunión</button></td>
                        <td><button class="btn btn-warning btn-sm" onclick="editarReunion(this)"><i
                                    class="bi bi-pencil"></i></button></td>
                        <td><button class="btn btn-danger btn-sm" onclick="abrirModalCancelar(this)"><i
                                    class="bi bi-x-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>Pedro Suárez</td>
                        <td>Física</td>
                        <td>07/07/2025</td>
                        <td>17:30</td>
                        <td>30 min</td>
                        <td><span class="estado estado-finalizada">Finalizada</span></td>
                        <td><button class="btn btn-gris btn-sm" onclick="abrirModal()">Ver resumen</button></td>
                        <td><button class="btn btn-warning btn-sm" onclick="editarReunion(this)"><i
                                    class="bi bi-pencil"></i></button></td>
                        <td><button class="btn btn-danger btn-sm" onclick="abrirModalCancelar(this)"><i
                                    class="bi bi-x-circle"></i></button></td>

                    </tr>
                    <tr>
                        <td>Martina López</td>
                        <td>Química</td>
                        <td>08/07/2025</td>
                        <td>20:00</td>
                        <td>60 min</td>
                        <td><span class="estado estado-activa">En curso</span></td>
                        <td><button class="btn btn-primary btn-sm"
                                onclick="window.location.href='vistaSalaReunion.html'">Ingresar</button></td>
                        <td><button class="btn btn-warning btn-sm" onclick="editarReunion(this)"><i
                                    class="bi bi-pencil"></i></button></td>

                        <td><button class="btn btn-danger btn-sm" onclick="abrirModalCancelar(this)"><i
                                    class="bi bi-x-circle"></i></button></td>


                    </tr>
                </tbody>
            </table>
            <!-- Botones debajo -->
            <div class="d-flex flex-column flex-sm-row justify-content-center gap-3 mt-4">
                <button class="btn btn-outline-success" onclick="abrirCrearModal()">➕ Crear reunión</button>

            </div>

        
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../script/cerrar-sesion.js"></script>



    <!-- Modal -->
    <div id="modalResumen" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Resumen de chat</h2>
                <span class="close" onclick="cerrarModal()">&times;</span>
            </div>

            <div id="chat" class="chat"></div>
            <button class="btn btn-primary download-btn" onclick="descargarChat()">Descargar en TXT</button>
        </div>
    </div>

    <!-- Modal Crear Reunión -->
    <div class="modal fade" id="crearModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="formCrear">
                    <div class="modal-header">
                        <h5 class="modal-title">Crear nueva reunión</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="alumno" class="form-label">Alumno</label>
                            <select class="form-select" id="alumno" required>
                                <option selected disabled>Elegí un alumno</option>
                                <option>Juan Pérez</option>
                                <option>Pedro Suárez</option>
                                <option>Martina López</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="materia" class="form-label">Materia</label>
                            <select class="form-select" id="materia" required>
                                <option selected disabled>Elegí una materia</option>
                                <option>Matemática</option>
                                <option>Física</option>
                                <option>Química</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fecha" class="form-label">Fecha</label>
                            <input type="date" class="form-control" id="fecha" required min="">
                        </div>
                        <div class="mb-3">
                            <label for="hora" class="form-label">Hora</label>
                            <input type="time" class="form-control" id="hora" required>
                        </div>
                        <div class="mb-3">
                            <label for="duracion" class="form-label">Duración (min)</label>
                            <input type="number" class="form-control" id="duracion" required min="10" step="5">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="btnGuardarModal">Aceptar</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!--modal cancelar-->
     <div class="modal fade" id="modalCancelarReunion" tabindex="-1" aria-labelledby="modalCancelarReunionLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title" id="modalCancelarReunionLabel">Cancelar reunión</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                aria-label="Cerrar"></button>
                        </div>
                        <div class="modal-body">
                            ¿Estás segura/o de cancelar la reunión?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                            <button type="button" class="btn btn-danger" id="btnConfirmarCancelacion">Sí,
                                cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
    <script>
        const mensajes = [
            { tiempo: "00:01", nombre: "Martín", mensaje: "Hola Juan, ¿ya estás conectado?" },
            { tiempo: "00:05", nombre: "Juan", mensaje: "Sí, profe. Buen día." },
            { tiempo: "00:10", nombre: "Martín", mensaje: "Hoy vamos a repasar funciones matemáticas." },
            { tiempo: "00:25", nombre: "Juan", mensaje: "Perfecto, estuve practicando un poco." },
            { tiempo: "00:40", nombre: "Martín", mensaje: "¿Recordás cómo se calcula el dominio?" },
            { tiempo: "00:50", nombre: "Juan", mensaje: "Más o menos, ¿me podría explicar de nuevo?" },
            { tiempo: "01:05", nombre: "Martín", mensaje: "Claro. El dominio son todos los valores posibles de entrada..." },
            { tiempo: "01:25", nombre: "Juan", mensaje: "Ahh, sí. Lo que no hace que el denominador sea cero." },
            { tiempo: "01:40", nombre: "Martín", mensaje: "Exactamente. Ahora hacé este ejercicio..." },
            { tiempo: "02:00", nombre: "Juan", mensaje: "¿El resultado sería x ≠ 2?" },
            { tiempo: "02:15", nombre: "Martín", mensaje: "Muy bien, Juan. ¡Perfecto!" },
            { tiempo: "02:30", nombre: "Juan", mensaje: "Gracias, profe. Me ayuda mucho esto." },
            { tiempo: "02:50", nombre: "Martín", mensaje: "Nos vemos en la próxima clase. Buen trabajo." }
        ];

        function abrirModal() {
            const modal = document.getElementById("modalResumen");
            const chatDiv = document.getElementById("chat");
            chatDiv.innerHTML = "";

            mensajes.forEach(msg => {
                chatDiv.innerHTML += `
          <div class="chat-message">
            <span class="time">[${msg.tiempo}]</span>
            <span class="name">${msg.nombre}:</span>
            <span class="text">${msg.mensaje}</span>
          </div>
        `;
            });

            modal.style.display = "block";
        }

        function cerrarModal() {
            document.getElementById("modalResumen").style.display = "none";
        }

        function descargarChat() {
            let contenido = "Resumen de la videollamada:\n\n";
            mensajes.forEach(msg => {
                contenido += `[${msg.tiempo}] ${msg.nombre}: ${msg.mensaje}\n`;
            });

            const blob = new Blob([contenido], { type: "text/plain" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "chat_martin_juan.txt";
            link.click();
        }

        // Cerrar modal con clic fuera
        window.onclick = function (event) {
            const modal = document.getElementById("modalResumen");
            if (event.target === modal) {
                cerrarModal();
            }
        };
    </script>

    <script>
        const crearModal = new bootstrap.Modal(document.getElementById('crearModal'));

        function abrirCrearModal() {
            // Actualizar min de fecha (hoy)
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').min = hoy;
            crearModal.show();
        }

        function formatearFecha(fecha, hora) {
            const [a, m, d] = fecha.split("-");
            return `${d}/${m}/${a} ${hora}`;
        }
    </script>

    <script>
        let filaEditando = null;

        function editarReunion(boton) {
            filaEditando = boton.closest("tr");

            // Obtener celdas
            const celdas = filaEditando.querySelectorAll("td");

            // Cargar valores en el modal
            document.getElementById("alumno").value = celdas[0].textContent.trim();
            document.getElementById("materia").value = celdas[1].textContent.trim();

            const [dia, mes, anio] = celdas[2].textContent.trim().split("/");
            document.getElementById("fecha").value = `${anio}-${mes}-${dia}`;
            document.getElementById("hora").value = celdas[3].textContent.trim();
            document.getElementById("duracion").value = celdas[4].textContent.replace(" min", "");

            // Abrir el modal
            crearModal.show();

            // Cambiar texto del botón
            document.getElementById("btnGuardarModal").textContent = "Guardar cambios";
        }


        function formatearFechaSoloFecha(fecha) {
            const [a, m, d] = fecha.split("-");
            return `${d}/${m}/${a}`;
        }

        document.getElementById('formCrear').addEventListener('submit', function (e) {
            e.preventDefault();

            const alumno = document.getElementById('alumno').value;
            const materia = document.getElementById('materia').value;
            const fecha = document.getElementById('fecha').value;
            const hora = document.getElementById('hora').value;
            const duracion = document.getElementById('duracion').value;

            if (!alumno || !materia || !fecha || !hora || !duracion) {
                alert("Por favor, completá todos los campos.");
                return;
            }

            const fechaFormateada = formatearFechaSoloFecha(fecha);

            if (filaEditando) {
                // Editar fila existente
                const celdas = filaEditando.querySelectorAll("td");
                celdas[0].textContent = alumno;
                celdas[1].textContent = materia;
                celdas[2].textContent = fechaFormateada;
                celdas[3].textContent = hora;
                celdas[4].textContent = `${duracion} min`;

                filaEditando = null;
                document.getElementById("btnGuardarModal").textContent = "Aceptar";
            } else {
                // Crear nueva fila
                const tabla = document.querySelector("#tablaReuniones tbody");
                const nuevaFila = `<tr>
                    <td>${alumno}</td>
                    <td>${materia}</td>
                    <td>${fechaFormateada}</td>
                    <td>${hora}</td>
                    <td>${duracion} min</td>
                    <td><span class="estado estado-pendiente">Pendiente</span></td>
                    <td><button class="btn btn-secondary btn-sm" onclick="window.location.href='vistaSalaReunion.html'">Iniciar reunión</button></td>
                    <td><button class="btn btn-outline-warning btn-sm" onclick="editarReunion(this)"><i class="bi bi-pencil"></i></button></td>
                    <td><button class="btn btn-outline-danger btn-sm"  onclick="abrirModalCancelar(this)"><i class="bi bi-x-circle"></i></button></td></tr>`;

                tabla.insertAdjacentHTML("beforeend", nuevaFila);
            }

            crearModal.hide();
            this.reset();
        });

        let filaAEliminar = null;

        function abrirModalCancelar(btn) {
            filaAEliminar = btn.closest("tr"); // guardamos la fila
            const modal = new bootstrap.Modal(document.getElementById('modalCancelarReunion'));
            modal.show();
        }

        document.getElementById('btnConfirmarCancelacion').addEventListener('click', () => {
            if (filaAEliminar) {
                filaAEliminar.remove();

                // Mostrar alerta Bootstrap
                const alertContainer = document.getElementById("alert-container");
                alertContainer.innerHTML = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>Reunión cancelada:</strong> Se le enviará una notificación al alumno.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;

                // Cerrar el modal
                const modalElement = document.getElementById('modalCancelarReunion');
                const modal = bootstrap.Modal.getInstance(modalElement);
                modal.hide();
            }
        });
    </script>

</body>

</html>